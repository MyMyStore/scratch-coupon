function initScratchCard() {
    const canvas = document.getElementById('scratch-canvas');
    const ctx = canvas.getContext('2d');
    const scratchArea = document.querySelector('.scratch-area');
    
    // 캔버스 크기 설정
    canvas.width = scratchArea.offsetWidth;
    canvas.height = scratchArea.offsetHeight;
    
    // 스크래치 영역 그리기 (회색 배경)
    ctx.fillStyle = '#DDDDDD';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // 스크래치 패턴 추가 (이슬이 튕겨나가는 부분에 마스크를 추가)
    for (let i = 0; i < 100; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        const radius = Math.random() * 2 + 1;
        
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fillStyle = '#CCCCCC';
        ctx.fill();
    }
    
    // 메시지 추가
    ctx.font = '14px sans-serif';
    ctx.fillStyle = '#888888';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('이곳을 긁어주세요', canvas.width / 2, canvas.height / 2);
    
    // 스크래치 카드가 준비될 때까지 기다린 후 "긁어주세요" 메시지 표시
    setTimeout(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height); // 초기화 후에 바로 결과 보이지 않도록 함
    }, 200); // 200ms 후 메시지를 지운 후 스크래치 효과 시작
    
    // 마우스/터치 이벤트 처리
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let scratchPercentage = 0;
    
    function getPosition(e) {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
        const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
        return { x, y };
    }
    
    function startDrawing(e) {
        isDrawing = true;
        const pos = getPosition(e);
        lastX = pos.x;
        lastY = pos.y;
    }
    
    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
        
        const pos = getPosition(e);
        const currentX = pos.x;
        const currentY = pos.y;
        
        // 지우개 효과
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = 25;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(currentX, currentY);
        ctx.stroke();
        
        lastX = currentX;
        lastY = currentY;
        
        // 지워진 영역 계산
        calculateScratchPercentage();
    }
    
    function stopDrawing() {
        isDrawing = false;
    }
    
    function calculateScratchPercentage() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const pixelData = imageData.data;
        let transparentPixels = 0;
        
        for (let i = 3; i < pixelData.length; i += 4) {
            if (pixelData[i] === 0) {
                transparentPixels++;
            }
        }
        
        const totalPixels = canvas.width * canvas.height;
        scratchPercentage = (transparentPixels / totalPixels) * 100;
        
        // 40% 이상 지워졌을 때 전체 공개
        if (scratchPercentage > 40 && canvas.style.opacity !== '0') {
            revealAll();
        }
    }
    
    function revealAll() {
        // 애니메이션으로 캔버스 투명화
        let opacity = 1;
        const fadeInterval = setInterval(() => {
            opacity -= 0.1;
            canvas.style.opacity = opacity;
            
            if (opacity <= 0) {
                clearInterval(fadeInterval);
                canvas.style.display = 'none';
                
                // 당첨시 축하 효과 (꽝이 아닌 경우)
                if (document.getElementById('prize-text').textContent !== '꽝') {
                    createConfetti();
                }
            }
        }, 30);
    }
    
    // 이벤트 리스너 등록
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseleave', stopDrawing);
    
    // 터치 이벤트
    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDrawing);
}
